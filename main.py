import telebot
import random
import time
from telebot.types import InlineKeyboardMarkup, InlineKeyboardButton

BOT_TOKEN = "8333098744:AAG60huJyo0PRLpEvakrG4H2-YKQUCCVqGk"
bot = telebot.TeleBot(BOT_TOKEN)

# ุฐุฎุฑู ุฒูุงู ุขุฎุฑู ูุงู ุจุฑุง ูุฑ ฺฉุงุฑุจุฑ
last_usage = {}

# ฺฉุงุฑุช ูุง ุชุงุฑูุช (ฒฒ ูุงฺูุฑ ุขุฑฺฉุงูุง)
tarot_cards = {
    "ุงุญูู": "ุดุฑูุน ุฌุฏุฏุ ูุงุฌุฑุงุฌูุ ุขุฒุงุฏ ุงุฒ ุชุฑุณ",
    "ุฌุงุฏูฺฏุฑ": "ูุฏุฑุช ุงุฑุงุฏูุ ุฎูุงูุชุ ุชูุงูุง ุชุญูู ุขุฑุฒููุง",
    "ฺฉุงููู ุงุนุธู": "ุดููุฏุ ุงุณุฑุงุฑุ ุฏุงูุง ูพููุงู",
    "ุงููพุฑุงุชุฑุณ": "ูุงุฏุฑุ ุนุดู ุจโูุฏุ ุญุงุตูุฎุฒ",
    "ุงููพุฑุงุชูุฑ": "ุงูุชุฏุงุฑุ ุฑูุจุฑุ ูุธู ู ูุงููู",
    "ฺฉุดุด ุงุนุธู": "ุณูุชุ ุขููุฒุดุ ุฑุงูููุง ูุนูู",
    "ุนุงุดูุงู": "ุนุดูุ ุงูุชุฎุงุจ ุณุฑููุดุชโุณุงุฒุ ุฑุงุจุทู ุนุงุทู",
    "ุงุฑุงุจู": "ูพุฑูุฒุ ุงุฑุงุฏู ููุ ุญุฑฺฉุช ุจู ุฌูู",
    "ูุฏุฑุช": "ุดุฌุงุนุช ุฏุฑููุ ฺฉูุชุฑู ููุณุ ูุฏุฑุช ุขุฑุงู",
    "ุฒุงูุฏ": "ุฌุณุชุฌู ุฏุฑููุ ุชููุงุ ุญฺฉูุช",
    "ฺุฑุฎ ุณุฑููุดุช": "ุชุบุฑุ ฺุฑุฎู ุฒูุฏฺฏุ ุณุฑููุดุช",
    "ุนุฏุงูุช": "ุญููุชุ ุชุนุงุฏูุ ูุชุฌู ููุตูุงูู",
    "ูุนูู": "ุชูููุ ุฏุฏฺฏุงู ุฌุฏุฏุ ุฑูุง ฺฉุฑุฏู",
    "ูุฑฺฏ": "ูพุงุงูุ ุฏฺฏุฑฺฏููุ ุดุฑูุน ุฏูุจุงุฑู",
    "ุงุนุชุฏุงู": "ุชุนุงุฏูุ ููุงููฺฏุ ุตุจุฑ",
    "ุดุทุงู": "ูุณูุณูุ ูุฏ ู ุจูุฏุ ุชุฑุณ ุฏุฑูู",
    "ุจุฑุฌ": "ุดูฺฉุ ูุฑููพุงุด ูุงฺฏูุงูุ ุชุบุฑ ูุงฺฏุฒุฑ",
    "ุณุชุงุฑู": "ุงูุฏุ ุงููุงูุ ุงูุงู",
    "ูุงู": "ุชูููุ ุดููุฏุ ูุงุงุทููุงู",
    "ุฎูุฑุดุฏ": "ุดุงุฏุ ููููุชุ ุฑูุดูุง",
    "ุฏุงูุฑ": "ุจุฏุงุฑุ ุชุตูู ูููุ ุฑุณุชุงุฎุฒ",
    "ุฌูุงู": "ุชฺฉุงููุ ููููุช ููุงุ ฺฉุงูู ุดุฏู"
}

# ูพุงู ุงูฺฏุฒุด
motivational = [
    "โจ ูุฑ ูพุงุงู ุดุฑูุน ุฌุฏุฏ ุงุณุช",
    "๐ ูุฏุฑุช ุชุบุฑ ุฏุฑ ุฏุณุชุงู ุชูุณุช",
    "๐ซ ุจู ุดููุฏุช ุงุนุชูุงุฏ ฺฉู",
    "๐ ุตุจุฑ ฺฉูุ ุฒูุงู ููุงุณุจ ูุฑุง ูุฑุณุฏ"
]

# start
@bot.message_handler(commands=['start'])
def start(message):
    bot.reply_to(message, "๐ฎ ุณูุงู! ุจุฑุง ุงูุชุฎุงุจ ููุน ูุงู ุฏุณุชูุฑ /tarot ุฑู ุจุฒู ๐")

# ุงูุชุฎุงุจ ููุน ูุงู
@bot.message_handler(commands=['tarot'])
def choose_tarot(message):
    user_id = message.from_user.id
    now = time.time()

    # ูุญุฏูุฏุช 24 ุณุงุนุช (86400 ุซุงูู)
    if user_id in last_usage and now - last_usage[user_id] < 86400:
        remaining = int(86400 - (now - last_usage[user_id])) // 3600
        bot.reply_to(message, f"โณ ุดูุง ุฑูุฒ ููุท ฺฉ ุจุงุฑ ูโุชููุฏ ูุงู ุจฺฏุฑุฏ.\nูุทูุงู {remaining} ุณุงุนุช ุฏฺฏู ุฏูุจุงุฑู ุงูุชุญุงู ฺฉูุฏ.")
        return

    # ุฐุฎุฑู ุฒูุงู ุฌุฏุฏ
    last_usage[user_id] = now

    # ุณุงุฎุช ฺฉุจูุฑุฏ ุงูุชุฎุงุจ
    markup = InlineKeyboardMarkup()
    markup.row_width = 2
    markup.add(
        InlineKeyboardButton("โค๏ธ ูุงู ุงุญุณุงุณ", callback_data="emotional"),
        InlineKeyboardButton("๐ฐ ฺฏุฐุดุชู/ุญุงู/ุขูุฏู", callback_data="timeline"),
        InlineKeyboardButton("๐ ูุงู ุนุดู", callback_data="love"),
        InlineKeyboardButton("โ๏ธ ูุงู ุชุตููโฺฏุฑ", callback_data="decision")
    )
    bot.send_message(message.chat.id, "ฺฉุฏูู ูุงู ุฑู ูุฎูุงุ ๐ฎ", reply_markup=markup)

# ููุฏูุฑ ุงูุชุฎุงุจ ูุงู
@bot.callback_query_handler(func=lambda call: True)
def callback_query(call):
    if call.data in ["emotional", "timeline", "love", "decision"]:
        cards = random.sample(list(tarot_cards.items()), 3)  # ุงูุชุฎุงุจ ณ ฺฉุงุฑุช ุชุตุงุฏู
        msg = random.choice(motivational)

        if call.data == "emotional":
            title = "โค๏ธ ูุงู ุงุญุณุงุณ"
            meaning_type = ["ุฏุฑูู ููุจุช", "ุฏุฑ ุงุญุณุงุณุงุชุช", "ุฏุฑ ุขูุฏูโ ุนุดู"]
        elif call.data == "timeline":
            title = "๐ฐ ูุงู ฺฏุฐุดุชู / ุญุงู / ุขูุฏู"
            meaning_type = ["ฺฏุฐุดุชู", "ุญุงู", "ุขูุฏู"]
        elif call.data == "love":
            title = "๐ ูุงู ุนุดู"
            meaning_type = ["ุชู", "ุงู", "ุฑุงุจุทู"]
        elif call.data == "decision":
            title = "โ๏ธ ูุงู ุชุตููโฺฏุฑ"
            meaning_type = ["ฺฏุฒูู ุงูู", "ฺฏุฒูู ุฏูู", "ูุชุฌู"]

        text = f"{title}\n\n"
        for i, (card, meaning) in enumerate(cards):
            text += f"๐ด {meaning_type[i]}:\n{card} โ {meaning}\n\n"
        text += f"{msg}\n\nโ ุจุฑุง ูุงู ฺฉุงูู ุจู ููุฑุงู ูููู ุจู ุชูฺฏุฑุงู @falfalika ูพุงู ุจุฏู"

        bot.send_message(call.message.chat.id, text)

# ุงุฌุฑุง ุฑุจุงุช
while True:
    try:
        bot.polling(none_stop=True)
    except Exception as e:
        print(f"โ๏ธ ุฎุทุง ุฏุฑ polling: {e}")
        time.sleep(5)
